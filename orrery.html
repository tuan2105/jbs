<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Interactive Orrery ‚Äî Sun ‚Ä¢ Earth ‚Ä¢ Moon</title>
  <style>
    :root{
      --size: min(90vmin, 720px);
      --sun: #ffcc33;
      --earth: #2ea0f5;
      --moon: #cfcfcf;
      --orbit: rgba(255,255,255,0.08);
      --bg: #0b1220;
      --fg: #e6eef8;
    }
    html,body{height:100%;}
    body{
      margin:0;
      background: radial-gradient(circle at 10% 10%, #071026 0%, var(--bg) 40%);
      color:var(--fg);
      font-family: system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
      display:flex;
      align-items:center;
      justify-content:center;
      padding:24px;
    }
    .page{
      width:var(--size);
      max-width:95vw;
      text-align:center;
    }
    h1{margin:0 0 8px;font-size:1.25rem}
    p.lead{margin:8px 0 18px;color:rgba(230,238,248,0.8)}

    .orrery-wrap{
      background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(0,0,0,0.05));
      border-radius:12px;
      padding:18px;
      box-shadow: 0 6px 30px rgba(2,6,23,0.6), inset 0 1px 0 rgba(255,255,255,0.02);
    }

    /* SVG sizing */
    .orrery{
      width:100%;
      height:var(--size);
      max-height:80vh;
      display:block;
      margin:0 auto 12px auto;
      touch-action: none; /* we'll handle touch gestures */
    }

    .controls{
      display:flex;
      gap:8px;
      align-items:center;
      justify-content:center;
      flex-wrap:wrap;
      margin-top:8px;
    }
    .controls .group{display:flex;gap:8px;align-items:center}
    button{background:#142034;color:var(--fg);border:1px solid rgba(255,255,255,0.04);padding:6px 10px;border-radius:8px;cursor:pointer}
    button:active{transform:translateY(1px)}
    input[type=range]{width:220px}
    .hint{font-size:0.85rem;color:rgba(230,238,248,0.7);margin-top:8px}

    /* a little label for the center */
    .legend{display:flex;gap:12px;align-items:center;justify-content:center;margin-top:10px}
    .legend span{font-size:0.85rem;color:rgba(230,238,248,0.8)}

    /* 3D and visual helpers */
    .orrery-wrap{perspective:1400px}
    :root{ --tiltX: 18deg; --tiltY: 0deg }
    .orrery-3d{transform-style:preserve-3d;transition:transform 220ms cubic-bezier(.2,.9,.3,1); transform:rotateX(var(--tiltX)) rotateY(var(--tiltY)); transform-origin:50% 50%;}
    .orrery-3d:active{transition:none}
    .orbit{stroke:rgba(255,255,255,0.05);stroke-width:1.2;filter:blur(0.2px)}
    .orbit:hover{stroke:rgba(255,255,255,0.12)}
    .planet{filter:url(#tinyGlow);cursor:pointer}
    .planet .shine{fill:rgba(255,255,255,0.7);opacity:0.13;mix-blend-mode:screen}

    /* volumetric helpers */
    .shadow{fill:rgba(0,0,0,0.22);filter:blur(3px);opacity:0.95}
    .atmosphere{opacity:0.25;mix-blend-mode:screen;filter:blur(2px)}
    .starburst line{stroke:#fff6d8;stroke-width:1.2;opacity:0.95;stroke-linecap:round}
    .starburst .ray{filter:url(#glowFilter)}

    /* comet tail */
    .comet-tail{opacity:0.95;filter:url(#tinyGlow)}

    .comet-core{fill:url(#cometCoreGradient)}
    .supernova-core{fill:url(#supernovaGradient);filter:url(#glowFilter)}

    /* supernova burst */
    .supernova{transform-origin:center;cursor:pointer;filter:url(#glowFilter)}
    .supernova.burst{animation:supernova-burst 1200ms ease-out forwards}
    @keyframes supernova-burst{0%{transform:scale(1);opacity:1}70%{transform:scale(6);opacity:0.95}100%{transform:scale(10);opacity:0}}

    /* aurora / geomagnetic storm */
    .aurora{stroke-linecap:round;stroke-width:3;fill:none;opacity:0;transition:opacity 220ms}
    .aurora.active{opacity:0.95;filter:blur(1px);mix-blend-mode:screen}

    /* outer rings */
    .ring{fill:none;stroke:rgba(255,255,255,0.035);stroke-width:1;stroke-dasharray:4 6}
    .ring.handle:hover{stroke:rgba(120,170,255,0.16);cursor:pointer}

    .legend span{opacity:0.95}

    /* accessibility focus styles */
    button:focus, input[type=range]:focus{outline:2px solid rgba(120,170,255,0.35);outline-offset:3px}
  </style>
</head>
<body>
  <main class="page">
    <h1>Interactive Orrery ‚Äî <small>Sun ‚Ä¢ Earth ‚Ä¢ Moon</small></h1>
    <p class="lead">Drag inside the model (or use the controls) to rotate the system. The orrery won't move on its own ‚Äî you rotate it manually.</p>

    <div class="orrery-wrap">
      <!-- SVG orrery -->
      <svg id="orrery" class="orrery" viewBox="-360 -360 720 720" aria-label="Orrery showing Sun, Earth, and Moon" role="img">
        <!-- Background grid / stars (subtle) -->
        <defs>
          <radialGradient id="sunGlow" cx="50%" cy="50%" r="50%">
            <stop offset="0%" stop-color="rgba(255,220,120,0.98)"/>
            <stop offset="45%" stop-color="rgba(255,200,60,0.65)"/>
            <stop offset="100%" stop-color="rgba(255,180,40,0.04)"/>
          </radialGradient>

          <radialGradient id="earthGradient" cx="40%" cy="35%" r="65%">
            <stop offset="0%" stop-color="#bfe9ff"/>
            <stop offset="35%" stop-color="#70c9ff"/>
            <stop offset="70%" stop-color="#2ea0f5"/>
            <stop offset="100%" stop-color="#083b58"/>
          </radialGradient>

          <radialGradient id="moonGradient" cx="40%" cy="40%" r="75%">
            <stop offset="0%" stop-color="#ffffff"/>
            <stop offset="60%" stop-color="#d0d0d0"/>
            <stop offset="100%" stop-color="#9a9a9a"/>
          </radialGradient>

          <linearGradient id="auroraGradient" x1="0" x2="1">
            <stop offset="0%" stop-color="#a1ffce" stop-opacity="0.95"/>
            <stop offset="45%" stop-color="#5ef1ff" stop-opacity="0.95"/>
            <stop offset="100%" stop-color="#9b8bff" stop-opacity="0.85"/>
          </linearGradient>

          <filter id="glowFilter" x="-60%" y="-60%" width="220%" height="220%">
            <feGaussianBlur stdDeviation="6" result="b"/>
            <feMerge>
              <feMergeNode in="b"/>
              <feMergeNode in="SourceGraphic"/>
            </feMerge>
          </filter>

          <filter id="tinyGlow" x="-30%" y="-30%" width="160%" height="160%">
            <feGaussianBlur stdDeviation="2" result="b"/>
            <feMerge>
              <feMergeNode in="b"/>
              <feMergeNode in="SourceGraphic"/>
            </feMerge>
          </filter>

          <radialGradient id="cometCoreGradient" cx="40%" cy="40%" r="60%">
            <stop offset="0%" stop-color="#ffffff"/>
            <stop offset="60%" stop-color="#dbeeff"/>
            <stop offset="100%" stop-color="#bcd8ff" stop-opacity="0.95"/>
          </radialGradient>

          <radialGradient id="supernovaGradient" cx="50%" cy="50%" r="60%">
            <stop offset="0%" stop-color="#ffffff"/>
            <stop offset="35%" stop-color="#fff2c7"/>
            <stop offset="65%" stop-color="#ffb36b"/>
            <stop offset="100%" stop-color="#ff704d" stop-opacity="0.0"/>
          </radialGradient>

          <radialGradient id="atmosphereGradient" cx="50%" cy="35%" r="70%">
            <stop offset="0%" stop-color="#e6fbff" stop-opacity="0.95"/>
            <stop offset="100%" stop-color="#9de6ff" stop-opacity="0.02"/>
          </radialGradient>

          <!-- subtle specular lighting for planets -->
          <filter id="specular" x="-40%" y="-40%" width="180%" height="180%">
            <feSpecularLighting result="specOut" specularConstant="0.8" specularExponent="16" lighting-color="#ffffff">
              <fePointLight x="-100" y="-100" z="200" />
            </feSpecularLighting>
            <feComposite in="specOut" in2="SourceGraphic" operator="arithmetic" k1="0" k2="1" k3="1" k4="0"/>
          </filter>
        </defs>

        <!-- Central sun (drawn separately so it doesn't rotate, visually fixed) -->
        <g id="sun" aria-hidden="true">
          <circle class="sunGlow" cx="0" cy="0" r="60" fill="rgba(255,200,80,0.06)"/>
          <circle cx="0" cy="0" r="36" fill="url(#sunGlow)" stroke="#ffd76b" stroke-width="2.5"></circle>
          <circle cx="0" cy="0" r="18" fill="var(--sun)"></circle>
          <ellipse class="shadow" cx="12" cy="18" rx="14" ry="6" opacity="0.08"></ellipse>
        </g>

        <!-- Everything that should rotate when user drags is in this group -->
        <g id="rot-group">
          <!-- Primary Orbits -->
          <circle class="orbit" cx="0" cy="0" r="180" fill="none" stroke="var(--orbit)" stroke-width="1.4"></circle>
          <circle class="orbit" cx="0" cy="0" r="260" fill="none" stroke="var(--orbit)" stroke-width="0.9" opacity="0.8"></circle>

          <!-- Outer rings for added elements -->
          <circle id="cometRing" class="ring handle" cx="0" cy="0" r="320" fill="none" aria-hidden="true"></circle>
          <circle id="supernovaRing" class="ring handle" cx="0" cy="0" r="380" fill="none" aria-hidden="true"></circle>

          <!-- Earth group: rotate(earthAngle) translate(earthRadius,0) -->
          <g id="earthGroup">
            <!-- Earth's orbit marker (small disk at orbit position) -->
            <g id="earthPos">
                <ellipse class="shadow" cx="6" cy="12" rx="10" ry="4" opacity="0.22"/>
              <circle class="planet" cx="0" cy="0" r="12" fill="url(#earthGradient)" stroke="#0e4e7a" stroke-width="1.2" filter="url(#specular)"></circle>
              <circle class="atmosphere" cx="0" cy="0" r="15" fill="url(#atmosphereGradient)" opacity="0.22"></circle>
              <circle class="shine" cx="-4" cy="-4" r="3" fill="rgba(255,255,255,0.9)" opacity="0.12"></circle>
              <text x="18" y="5" font-size="12" fill="rgba(230,238,248,0.85)">Earth</text>
            </g>

            <!-- Moon group positioned relative to Earth -->
            <g id="moonGroup">
              <ellipse class="shadow" cx="3" cy="6" rx="5" ry="2.2" opacity="0.24"/>
              <circle class="planet" cx="0" cy="0" r="6" fill="url(#moonGradient)" stroke="#9e9e9e" stroke-width="0.8"/>
            </g>

            <!-- Geomagnetic storm (aurora) group placed around Earth -->
            <g id="stormGroup" aria-hidden="true">
              <!-- layered aurora arcs for depth -->
              <g class="aurora-layer">
                <path class="aurora" id="aurora1" d="M -30 -28 Q 0 -56 30 -28" stroke="url(#auroraGradient)"></path>
                <path class="aurora" id="aurora1b" d="M -34 -26 Q 0 -52 34 -26" stroke="url(#auroraGradient)" opacity="0.6"></path>
              </g>
              <g class="aurora-layer">
                <path class="aurora" id="aurora2" d="M -36 -20 Q 0 -48 36 -20" stroke="url(#auroraGradient)"></path>
                <path class="aurora" id="aurora2b" d="M -40 -18 Q 0 -44 40 -18" stroke="url(#auroraGradient)" opacity="0.6"></path>
              </g>
              <g class="aurora-layer">
                <path class="aurora" id="aurora3" d="M -24 -34 Q 0 -64 24 -34" stroke="url(#auroraGradient)"></path>
                <path class="aurora" id="aurora3b" d="M -28 -32 Q 0 -60 28 -32" stroke="url(#auroraGradient)" opacity="0.6"></path>
              </g>
            </g>
          </g>

          <!-- Comet group on outer ring -->
          <g id="cometGroup">
            <g id="cometPos" transform="rotate(60) translate(320, 0)">
              <g id="cometTail" class="comet-tail">
                <path d="M -36 6 C -120 14 -160 40 -200 90 L -144 30 C -120 10 -88 2 -48 2" fill="rgba(200,220,255,0.06)" />
                <path d="M -28 4 C -60 12 -96 28 -140 64" stroke="rgba(200,220,255,0.18)" stroke-width="3" fill="none" stroke-linecap="round"></path>
              </g>
              <ellipse class="shadow" cx="3" cy="5" rx="6" ry="2.6" opacity="0.3"/>
              <circle id="cometCore" class="comet-core" cx="0" cy="0" r="6" stroke="#bcd8ff" stroke-width="0.8"></circle>
            </g>
          </g>

          <!-- Supernova (a distant star on outermost ring) -->
          <g id="supernovaGroup">
            <g id="supernovaPos" transform="rotate(230) translate(380, 0)">
              <g id="supernova" class="supernova">
                <circle class="supernova-core" r="8" fill="url(#supernovaGradient)" stroke="#ffd88f" stroke-width="0.8" opacity="0.98"/>
                <circle r="18" fill="rgba(255,210,120,0.06)"/>
                <g class="starburst" aria-hidden="true">
                  <!-- several rays rotated for volumetric look -->
                  <line x1="0" y1="-10" x2="0" y2="-30" class="ray"/>
                  <line x1="0" y1="10" x2="0" y2="30" class="ray"/>
                  <line x1="-10" y1="0" x2="-30" y2="0" class="ray"/>
                  <line x1="10" y1="0" x2="30" y2="0" class="ray"/>
                  <line x1="-8" y1="-8" x2="-24" y2="-24" class="ray"/>
                  <line x1="8" y1="-8" x2="24" y2="-24" class="ray"/>
                  <line x1="-8" y1="8" x2="-24" y2="24" class="ray"/>
                  <line x1="8" y1="8" x2="24" y2="24" class="ray"/>
                </g>
              </g>
            </g>
          </g>

        </g>

      </svg>

      <div class="controls" aria-hidden="false">
        <div class="group">
          <button id="rotateLeft" title="Rotate left">‚ü≤</button>
          <button id="rotateRight" title="Rotate right">‚ü≥</button>
          <button id="resetBtn" title="Reset rotation">Reset</button>
        </div>

        <div class="group" style="min-width:260px;">
          <label for="rotationRange" style="font-size:0.85rem">Rotation</label>
          <input id="rotationRange" type="range" min="0" max="360" value="0" step="1" aria-label="Rotate system"/>
        </div>

        <div class="group" style="min-width:240px;">
          <label for="moonRange" style="font-size:0.85rem">Moon angle</label>
          <input id="moonRange" type="range" min="0" max="360" value="60" step="1" aria-label="Rotate moon around Earth"/>
        </div>

        <div class="group" style="min-width:220px;">
          <label for="tiltXRange" style="font-size:0.85rem">Tilt X</label>
          <input id="tiltXRange" type="range" min="-45" max="45" value="18" step="1" aria-label="Tilt orrery X axis"/>
        </div>
        <div class="group" style="min-width:220px;">
          <label for="tiltYRange" style="font-size:0.85rem">Tilt Y</label>
          <input id="tiltYRange" type="range" min="-180" max="180" value="0" step="1" aria-label="Tilt orrery Y axis"/>
        </div>

        <div class="group" style="min-width:240px;">
          <label for="cometRange" style="font-size:0.85rem">Comet angle</label>
          <input id="cometRange" type="range" min="0" max="360" value="60" step="1" aria-label="Rotate comet around system"/>
          <button id="cometToggle" title="Toggle comet">Comet</button>
        </div>

        <div class="group" style="min-width:260px;">
          <label for="supernovaRange" style="font-size:0.85rem">Supernova angle</label>
          <input id="supernovaRange" type="range" min="0" max="360" value="230" step="1" aria-label="Rotate supernova around system"/>
          <button id="supernovaTrigger" title="Trigger supernova">Trigger</button>
        </div>

        <div class="group" style="min-width:260px;">
          <label for="stormRange" style="font-size:0.85rem">Storm angle</label>
          <input id="stormRange" type="range" min="0" max="360" value="0" step="1" aria-label="Rotate geomagnetic storm around Earth"/>
          <button id="stormToggle" title="Toggle storm">Storm</button>
        </div>

        <div class="group" style="min-width:260px;">
          <label for="stormRange" style="font-size:0.85rem">Storm angle</label>
          <input id="stormRange" type="range" min="0" max="360" value="0" step="1" aria-label="Rotate geomagnetic storm around Earth"/>
          <button id="stormToggle" title="Toggle storm">Storm</button>
        </div>
      </div>

      <div class="hint">Tip: Drag the model to rotate. Use arrow buttons or the <strong>Rotation</strong> slider for precise control; use <strong>Moon angle</strong> to move the Moon around the Earth.</div>

      <div class="legend">
        <span>‚òÄÔ∏è Sun</span>
        <span>üåç Earth</span>
        <span>üåï Moon</span>
      </div>
    </div>

    <p style="font-size:0.9rem;margin-top:14px;color:rgba(230,238,248,0.75)">Made interactive with pointer drag, keyboard, and sliders. (No automatic animation.)</p>
  </main>

  <script>
    (function(){
      const svg = document.getElementById('orrery');
      svg.classList.add('orrery-3d');
      const wrap = document.querySelector('.orrery-wrap');
      const rotGroup = document.getElementById('rot-group');
      const earthGroup = document.getElementById('earthGroup');
      const earthPos = document.getElementById('earthPos');
      const moonGroup = document.getElementById('moonGroup');

      // New elements
      const cometGroup = document.getElementById('cometGroup');
      const cometPos = document.getElementById('cometPos');
      const cometTail = document.getElementById('cometTail');
      const cometCore = document.getElementById('cometCore');
      const supernovaGroup = document.getElementById('supernovaGroup');
      const supernovaEl = document.getElementById('supernova');
      const stormGroup = document.getElementById('stormGroup');

      const rotationRange = document.getElementById('rotationRange');
      const moonRange = document.getElementById('moonRange');
      const leftBtn = document.getElementById('rotateLeft');
      const rightBtn = document.getElementById('rotateRight');
      const resetBtn = document.getElementById('resetBtn');

      const tiltXRange = document.getElementById('tiltXRange');
      const tiltYRange = document.getElementById('tiltYRange');
      const cometRange = document.getElementById('cometRange');
      const cometToggle = document.getElementById('cometToggle');
      const supernovaRange = document.getElementById('supernovaRange');
      const supernovaTrigger = document.getElementById('supernovaTrigger');
      const stormRange = document.getElementById('stormRange');
      const stormToggle = document.getElementById('stormToggle');

      // Config
      const earthRadius = 180; // distance from center
      const moonRadius = 34; // distance from Earth
      const cometRadius = 320;
      const supernovaRadius = 380;

      // State
      let systemRotation = 0; // degrees
      let earthAngle = 0;     // degrees around sun
      let moonAngle = parseFloat(moonRange.value) || 60; // degrees around earth
      let tiltXDeg = parseFloat(tiltXRange.value) || 18;
      let tiltYDeg = parseFloat(tiltYRange.value) || 0;
      let cometAngle = parseFloat(cometRange.value) || 60;
      let cometVisible = true;
      let supernovaAngle = parseFloat(supernovaRange.value) || 230;
      let stormAngle = parseFloat(stormRange.value) || 0;
      let stormActive = false;

      // helper to set tilt
      function updateTilt(){
        document.documentElement.style.setProperty('--tiltX', tiltXDeg + 'deg');
        document.documentElement.style.setProperty('--tiltY', tiltYDeg + 'deg');
        svg.style.transform = `rotateX(${tiltXDeg}deg) rotateY(${tiltYDeg}deg)`;
        tiltXRange.value = Math.round(tiltXDeg);
        tiltYRange.value = Math.round(tiltYDeg);
      }

      // Tilt dragging state
      let tilting = false;
      let startClientX = 0, startClientY = 0, startTiltX = 0, startTiltY = 0;

      // Helper: apply transforms
      function updateTransforms(){
        // rotate the whole system
        rotGroup.setAttribute('transform', `rotate(${systemRotation})`);

        // position earth: rotate by earthAngle then translate out
        earthGroup.setAttribute('transform', `rotate(${earthAngle}) translate(${earthRadius}, 0)`);

        // position moon relative to earth: rotate then translate
        moonGroup.setAttribute('transform', `rotate(${moonAngle}) translate(${moonRadius}, 0)`);

        // comet
        cometPos.setAttribute('transform', `rotate(${cometAngle}) translate(${cometRadius}, 0)`);
        // rotate tail so it appears 'trailing' (point opposite direction)
        cometTail.setAttribute('transform', `rotate(${cometAngle+180})`);
        cometGroup.style.display = cometVisible ? 'block' : 'none';

        // supernova
        const snPos = document.getElementById('supernovaPos');
        snPos.setAttribute('transform', `rotate(${supernovaAngle}) translate(${supernovaRadius}, 0)`);

        // storm: rotate the aurora group around the Earth
        stormGroup.setAttribute('transform', `rotate(${stormAngle})`);

        rotationRange.value = ((systemRotation % 360) + 360) % 360; // normalize to 0-360
      }

      // Initialize positions
      earthAngle = 0;
      updateTilt();
      updateTransforms();

      // Controls: sliders & buttons
      rotationRange.addEventListener('input', (e)=>{
        systemRotation = parseFloat(e.target.value);
        updateTransforms();
      });
      moonRange.addEventListener('input', (e)=>{
        moonAngle = parseFloat(e.target.value);
        updateTransforms();
      });
      tiltXRange.addEventListener('input', (e)=>{ tiltXDeg = parseFloat(e.target.value); updateTilt(); });
      tiltYRange.addEventListener('input', (e)=>{ tiltYDeg = parseFloat(e.target.value); updateTilt(); });

      cometRange.addEventListener('input', (e)=>{ cometAngle = parseFloat(e.target.value); updateTransforms(); });
      cometToggle.addEventListener('click', ()=>{ cometVisible = !cometVisible; cometToggle.classList.toggle('active', cometVisible); updateTransforms(); });

      supernovaRange.addEventListener('input', (e)=>{ supernovaAngle = parseFloat(e.target.value); updateTransforms(); });
      supernovaTrigger.addEventListener('click', ()=>{
        // trigger burst animation
        supernovaEl.classList.remove('burst');
        // force reflow so animation restarts
        void supernovaEl.offsetWidth;
        supernovaEl.classList.add('burst');
      });
      supernovaEl.addEventListener('animationend', ()=>{
        // remove burst class after animation finishes so it can be triggered again
        supernovaEl.classList.remove('burst');
      });

      stormRange.addEventListener('input', (e)=>{ stormAngle = parseFloat(e.target.value); updateTransforms(); });
      stormToggle.addEventListener('click', ()=>{
        stormActive = !stormActive;
        const auroras = document.querySelectorAll('.aurora');
        auroras.forEach(a => a.classList.toggle('active', stormActive));
        stormToggle.classList.toggle('active', stormActive);
      });

      leftBtn.addEventListener('click', ()=>{ systemRotation = (systemRotation - 15); updateTransforms(); });
      rightBtn.addEventListener('click', ()=>{ systemRotation = (systemRotation + 15); updateTransforms(); });
      resetBtn.addEventListener('click', ()=>{
        systemRotation = 0; earthAngle = 0; moonAngle = 60; moonRange.value = moonAngle;
        tiltXDeg = 18; tiltYDeg = 0; tiltXRange.value = tiltXDeg; tiltYRange.value = tiltYDeg; cometAngle = 60; cometRange.value = cometAngle; cometVisible = true; supernovaAngle = 230; supernovaRange.value = supernovaAngle; stormAngle = 0; stormRange.value = stormAngle; updateTilt(); updateTransforms();
      });

      leftBtn.addEventListener('click', ()=>{ systemRotation = (systemRotation - 15); updateTransforms(); });
      rightBtn.addEventListener('click', ()=>{ systemRotation = (systemRotation + 15); updateTransforms(); });
      resetBtn.addEventListener('click', ()=>{ systemRotation = 0; earthAngle = 0; moonAngle = 60; moonRange.value = moonAngle; tiltDeg = 18; tiltRange.value = tiltDeg; cometAngle = 60; cometRange.value = cometAngle; cometVisible = true; supernovaAngle = 230; supernovaRange.value = supernovaAngle; stormAngle = 0; stormRange.value = stormAngle; updateTilt(); updateTransforms(); });

      // Keyboard: left/right arrow to rotate when any control focused
      document.addEventListener('keydown', (ev)=>{
        if( ev.key === 'ArrowLeft' ) { systemRotation -= 10; updateTransforms(); }
        if( ev.key === 'ArrowRight' ) { systemRotation += 10; updateTransforms(); }
      });

      // Pointer rotation (drag to rotate the system around center)
      let dragging = false;
      let startAngle = 0; // radians
      let startRotation = 0; // degrees

      function getCenterClient(){
        const r = svg.getBoundingClientRect();
        return { x: r.left + r.width/2, y: r.top + r.height/2 };
      }

      function clientAngle(ev){
        const center = getCenterClient();
        const x = (ev.clientX ?? ev.touches?.[0]?.clientX) - center.x;
        const y = (ev.clientY ?? ev.touches?.[0]?.clientY) - center.y;
        return Math.atan2(y, x); // radians
      }

      function onPointerDown(ev){
        ev.preventDefault();
        // If user holds shift while pressing, enter tilt mode (X/Y), otherwise rotate
        if(ev.shiftKey){
          tilting = true;
          startClientX = ev.clientX;
          startClientY = ev.clientY;
          startTiltX = tiltXDeg;
          startTiltY = tiltYDeg;
          if(ev.pointerId) svg.setPointerCapture(ev.pointerId);
          return;
        }

        // Use pointer events if available for rotation
        dragging = true;
        startAngle = clientAngle(ev);
        startRotation = systemRotation;
        // capture if pointer events
        if(ev.pointerId) svg.setPointerCapture(ev.pointerId);
      }

      function onPointerMove(ev){
        if(tilting){
          if(ev.clientX == null) return;
          const dx = ev.clientX - startClientX;
          const dy = ev.clientY - startClientY;
          // sensitivity: 0.25 deg per px
          tiltYDeg = startTiltY + dx * 0.25;
          tiltXDeg = Math.max(-80, Math.min(80, startTiltX - dy * 0.25));
          tiltXRange.value = Math.round(tiltXDeg);
          tiltYRange.value = Math.round(tiltYDeg);
          updateTilt();
          return;
        }

        if(!dragging) return;
        const angle = clientAngle(ev);
        const delta = angle - startAngle; // radians
        const deltaDeg = delta * 180 / Math.PI;
        systemRotation = startRotation + deltaDeg;
        updateTransforms();
      }

      function onPointerUp(ev){
        dragging = false;
        tilting = false;
        if(ev.pointerId) svg.releasePointerCapture(ev.pointerId);
      }

      // Support pointer events and touch/mouse fallbacks
      svg.addEventListener('pointerdown', onPointerDown);
      window.addEventListener('pointermove', onPointerMove);
      window.addEventListener('pointerup', onPointerUp);

      // For older touch devices fall back to touch events
      svg.addEventListener('touchstart', (e)=> onPointerDown(e.touches[0]));
      window.addEventListener('touchmove', (e)=> onPointerMove(e.touches[0]));
      window.addEventListener('touchend', (e)=> onPointerUp({pointerId: null}));

      // Simple accessibility: clicking the Earth will rotate earth angle by +30 deg
      earthPos.addEventListener('click', ()=>{ earthAngle = (earthAngle + 30) % 360; updateTransforms(); });

      // Allow clicking on outer rings to rotate their items by 30deg
      document.getElementById('cometRing').addEventListener('click', ()=>{ cometAngle = (cometAngle + 30) % 360; cometRange.value = cometAngle; updateTransforms(); });
      document.getElementById('supernovaRing').addEventListener('click', ()=>{ supernovaAngle = (supernovaAngle + 30) % 360; supernovaRange.value = supernovaAngle; updateTransforms(); });

      // Resize handler to keep range values consistent
      window.addEventListener('resize', ()=> updateTransforms());

      // Initial update
      updateTransforms();
    })();
  </script>
</body>
</html>
